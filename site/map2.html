<html>
<head>
<title>Map</title>
<meta charset="utf-8" />
<script type="text/javascript"
	src="http://maps.google.com/maps/api/js?sensor=false"></script>
<script type="text/javascript"
	src="http://code.jquery.com/jquery-1.7.min.js"></script>
<script type="text/javascript" src="http://www.google.com/jsapi"></script>
<script type="text/javascript"
	src="http://openweathermap.org/js/OWM.GoogleMap.1.0.js"></script>
<script src="../js/app/map/map_weather.js" type="text/javascript"></script>
<script src="../js/app/map/chat.js" type="text/javascript"></script>
<link rel="stylesheet" type="text/css" href="../css/app/map.css">
<link rel="stylesheet" type="text/css" href="../css/bootstrap/bootstrap.css">
<script type="text/javascript">
	var map;
	var markerAkt;
	var lastmarker;
	var routezeichnen = 0;
	var abstandmessen = 0;
	var routePoints = [];
	var abstandPoints = [];
	var markers = [];
	//WetterMarker
	var markersArray = [];
	var abstandmarkers = [];
	var polylines = [];
	var abstandpolylines = [];
	var route;
	var routegezeichnet = 0;
	var abstandmessen = 0;
	var controlUI;
	var controlText;
	var abbrechenUI;
	var abbrechenText;
	var redoUI;
	var redoText;
	var max;
	var oldMarker;
	var aktualisieren = 0;
	var routebeendet = 0;
	var routeloeschen = 0;
	var markerKoords;
	var zoomlevel;
	var iActiveMarker = -1;
	var kartentyp = 0;

	function initialize() {
		var latlng = new google.maps.LatLng(47.66, 9.16);
		var mapTypeIds = [ "roadmap", "satellite", "OSM", "Wetterkarte"];
		var myOptions = {
			zoom : 14,
			center : latlng,
			mapTypeId : google.maps.MapTypeId.ROADMAP,
			mapTypeControlOptions : {
				mapTypeIds : mapTypeIds
			}
		};
		map = new google.maps.Map(document.getElementById("map_canvas"),
				myOptions);

		
		map.mapTypes.set("Wetterkarte", new google.maps.ImageMapType({
			getTileUrl : function(coord, zoom) {
				return "http://tile.openstreetmap.org/" + zoom + "/" + coord.x
						+ "/" + coord.y + ".png";
			},
			tileSize : new google.maps.Size(256, 256),
			name : "Wetterkarte",
			maxZoom : 18
		}));

		map.mapTypes.set("OSM", new google.maps.ImageMapType({
			getTileUrl : function(coord, zoom) {
				return "http://tile.openstreetmap.org/" + zoom + "/" + coord.x
						+ "/" + coord.y + ".png";
			},
			tileSize : new google.maps.Size(256, 256),
			name : "OpenStreetMap",
			maxZoom : 18
		}));
		map.overlayMapTypes.push(new google.maps.ImageMapType({
			getTileUrl : function(coord, zoom) {
				return "http://tiles.openseamap.org/seamark/" + zoom + "/"
						+ coord.x + "/" + coord.y + ".png";
			},
			tileSize : new google.maps.Size(256, 256),
			name : "OpenSeaMap",
			maxZoom : 18
		}));

		map.overlayMapTypes
				.push(new google.maps.ImageMapType(
						{
							getTileUrl : function(coord, zoom) {
								return "http://www.openportguide.org/tiles/actual/air_temperature/5/"
										+ zoom
										+ "/"
										+ coord.x
										+ "/"
										+ coord.y
										+ ".png";
							},
							tileSize : new google.maps.Size(256, 256),
							name : "OpenSeaMap",
							maxZoom : 18
						}));

		map.overlayMapTypes
				.push(new google.maps.ImageMapType(
						{
							getTileUrl : function(coord, zoom) {
								return "http://www.openportguide.org/tiles/actual/wind_vector/7/"
										+ zoom
										+ "/"
										+ coord.x
										+ "/"
										+ coord.y
										+ ".png";
							},
							tileSize : new google.maps.Size(256, 256),
							name : "OpenSeaMap",
							maxZoom : 18
						}));
						
		

		// Benutzerfl�che Beenden-Button		
		var homeControlDiv = document.createElement('DIV');
		var test = new beenden(homeControlDiv, map);
		homeControlDiv.index = 1;
		map.controls[google.maps.ControlPosition.RIGHT_CENTER]
		.push(homeControlDiv);
		
		
		document.getElementById('weatherinformation').style.display = "none";
		var weatherDisplayDiv = document.getElementById('weatherinformation');
		map.controls[google.maps.ControlPosition.TOP_LEFT].push(weatherDisplayDiv);
		
		// var homeControl = document.getElementById('test');
	    // var test = new beenden(homeControl, map);
		 // document.getElementById('test').style.display = "none";
		 // map.controls[google.maps.ControlPosition.RIGHT_CENTER].push(homeControl);
		
		
		//Koordinaten anzeigen
		var koordinaten = document.getElementById('koords');
		map.controls[google.maps.ControlPosition.TOP_CENTER].push(koordinaten);
		
		//Koordinaten anzeigen
		var buttons = document.getElementById('buttons');
		map.controls[google.maps.ControlPosition.LEFT_BOTTOM].push(buttons);

		google.maps.event.addListener( map, 'maptypeid_changed', function() { 
    		if(map.getMapTypeId() == "Wetterkarte"){
				kartentyp = 1;
				var bounds = map.getBounds();
				var ln = bounds.getNorthEast();
				var ln2 = bounds.getSouthWest();
				var z = map.getZoom();
				var myhre = 'http://openweathermap.org/data/getrect?type=city&cnt=200&lat1='
									+ ln2.lat()
									+ '&lat2='
									+ ln.lat()
									+ '&lng1='
									+ ln2.lng()
									+ '&lng2='
									+ ln.lng()
									+ "&cluster=yes&zoom="
									+ z
									+ "&callback=?";
				$.getJSON(myhre, getData);
			}else{
				kartentyp = 0;
				deleteOverlays(); 
			}
		} );
		
		
		google.maps.event
				.addListener(
						map,
						'idle',
						function() {
							var bounds = map.getBounds();
							var ln = bounds.getNorthEast();
							var ln2 = bounds.getSouthWest();
							var z = map.getZoom();
							var myhre = 'http://openweathermap.org/data/getrect?type=city&cnt=200&lat1='
									+ ln2.lat()
									+ '&lat2='
									+ ln.lat()
									+ '&lng1='
									+ ln2.lng()
									+ '&lng2='
									+ ln.lng()
									+ "&cluster=yes&zoom="
									+ z
									+ "&callback=?";
							if(kartentyp == 1){
								$.getJSON(myhre, getData);
							}else{
								deleteOverlays(); 
							}
							
						});
		
			

		
		
		//Schaut ob sich das Center verschoben hat 
		google.maps.event.addListener(map, 'center_changed', function() {
			var lat = map.getCenter().lat();
			var lng = map.getCenter().lng();
			var lat_h = Math.floor(lat);
			if (Math.abs(lat_h) < 10) {
				if (lat_h < 0) {
					lat_h = "-0" + Math.abs(lat_h);
				} else {
					lat_h = "0" + lat_h;
				}
			}

			var lat_m = Math.floor((lat - lat_h) * 10000) / 100;
			if (lat_m < 10) {
				lat_m = "0" + lat_m;
			}
			var lng_h = Math.floor(lng);
			if (Math.abs(lng_h) < 10) {
				if (lng_h < 0) {
					lng_h = "-00" + Math.abs(lng_h);
				} else {
					lng_h = "00" + lng_h;
				}
			} else if (Math.abs(lng_h) < 100) {
				if (lng_h < 0) {
					lng_h = "-0" + Math.abs(lng_h);
				} else {
					lng_h = "0" + lng_h;
				}
			}

			var lng_m = Math.floor((lng - lng_h) * 10000) / 100;
			if (lng_m < 10) {
				lng_m = "0" + lng_m;
			}
			document.getElementById("lat").firstChild.nodeValue = lat_h + "°"
					+ lat_m + "'N";
			document.getElementById("long").firstChild.nodeValue = lng_h + "°"
					+ lng_m + "'E";
		})

		
		//Hole Wetter Daten
		function getData(s) {
			station_list = s;

			if (station_list.cod != '200') {
				alert('Test ' + JSONobject.message);
				return;
			}

			deleteOverlays();

			infowindow = new google.maps.InfoWindow({
				content : "place holder",
				disableAutoPan : false
			})

			for ( var i = 0; i < station_list.list.length; i++) {
				var p = new google.maps.LatLng(station_list.list[i].lat,
						station_list.list[i].lng);
						
				var name = station_list.list[i].name;
				var temp = station_list.list[i].temp - 273;
				var pressure = station_list.list[i].pressure;
				temp = Math.round(temp * 100) / 100;
				// test2 = getIcon(name);
				// console.log(test2);
				img = GetWeatherIcon(station_list.list[i]);

				var html_b = '<div>\<img src="http://openweathermap.org'+img+'" height="50px" width="60px" style="float: left; "><b>'+ temp + 'C</b></div>';
			

				var m = new StationMarker(p, map, html_b);
				m.station_id = i;
				m.name =name;
				m.icon=img;
				
				
				
				markersArray.push(m);
				

			}
			
			setWeatherMarkerListener(markersArray);
			
			

		}
		
		function setWeatherMarkerListener(weathermarker) {
			
			for ( var i = 0; i < weathermarker.length; i++) {
			//		//console.log("test"+weathermarker[i].name);
			//		var name = weathermarker[i].name;
			(function () {
   				 var name=weathermarker[i].name;
   				 var icon=weathermarker[i].icon;
   						 
   				 google.maps.event.addListener(weathermarker[i], 'click', function() {
   				 	$('#weather_icon').html('<div><img src="http://openweathermap.org'+icon+'" height="50px" width="60px" style="float: left; "></div>');
   				 	$('#city_name').html(name);
     			   var myhre = 'http://openweathermap.org/data/2.5/weather?q='
								 +name
								 +'&mode=json&units=metric&cnt=7'
								 + "&callback=?";
				
							
							 $.getJSON(myhre, getWeatherData);
  				  });
				})();
			}
				
			//		f (obj == markersArray[i]) {
			//			markersArray[i].setMap(null);
				//	}
					// var myhre = 'http://openweathermap.org/data/2.5/forecast/daily?q='
								// +name
								// +'&mode=json&units=metric&cnt=7'
								// + "&callback=?";
							// $.getJSON(myhre, getWeatherData);
					// alert(name);
					// showWeatherInfo(html_b, pressure);
					//testFunction(m.name);
					//console.log(weathermarker[i]);
					//alert("stadt:"+weathermarker[i].name);
					
					
				// });
			//}
			
			
		}
		
		//Hole Wetter Daten
		function getWeatherData(data) {
			
			data = correctWeatherData(data);
			data = data.list[0];
			// console.log(data);
			

			

			var projection;
		var weatherMenu;
		projection = map.getProjection();
		$('.markermenu').remove();
	
		// $(pressure).html(data.pressure);
		// $(max_temp).html(data.temp.day.toFixed(0) + "°");
		// $(min_temp).html(data.temp.min.toFixed(0) + "°");
		//$(winds).html(data.clouds);
		// $(clouds).text(CloudIdToDescription(data.clouds));
		document.getElementById('weatherinformation').style.display = "block";
		document.getElementById('weatherinformation').style.visibility = "visible";
			

		}

		var obj;

		function deleteOverlays() {
			var temp_marker;
			if (markersArray) {
				for (i in markersArray) {
					if (obj != markersArray[i]) {
						markersArray[i].setMap(null);
					}
				}
				markersArray.length = 0;
				if (temp_marker != undefined) {
					markersArray.push(temp_marker);
					iActiveMarker = -1;
				}
			}
		}

		google.maps.event.addListener(map, "rightclick", function(event) {
			$('.markermenu').remove();
			if (lastmarker) {
				lastmarker.setMap(null);
			}
			if (routezeichnen == 1 || abstandmessen == 1) {
				//Route zeichnen oder Abstand messen -->Marker setzen,Route zeichnen
				lastmarker = new google.maps.Marker({
					position : event.latLng,
					map : map,
					icon : "../img/icons/cross_hair.png",
					draggable : true
				});
				marker();
				polyline();
			} else {
				//Wenn Route nicht gezeichnet oder Abstand nicht gemessen wird -->Fadenkreuz setzen
				lastmarker = new google.maps.Marker({
					position : event.latLng,
					map : map,
					icon : "../img/icons/cross_hair.png",
					draggable : true
				});
			}
			showContextMenu(event.latLng);
		});

		google.maps.event.addListener(map, "click", function(event) {
			//$('.markermenu').remove();
			if (lastmarker) {
				lastmarker.setMap(null);
			}
			if (routezeichnen == 1 || abstandmessen == 1) {
				//Route zeichnen oder Abstand messen -->Marker setzen,Route zeichnen
				lastmarker = new google.maps.Marker({
					position : event.latLng,
					map : map,
					icon : "../img/icons/cross_hair.png",
					draggable : true
				});
				marker();
				polyline();
			}
		});

	}

	
	//Testweise Dropdownmenu
	function addDropDown(map) {
		var dropdown = document.getElementById('dropdown-holder');
		map.controls[google.maps.ControlPosition.TOP_RIGHT].push(dropdown);
	}

	
	//Anzeigen des Kontextmenues
	function showContextMenu(caurrentLatLng) {
		var projection;
		var contextmenuDir;
		projection = map.getProjection();
		$('.contextmenu').remove();
		contextmenuDir = document.createElement("div");
		contextmenuDir.className = 'contextmenu';
		contextmenuDir.innerHTML = "<table>"
				+ "<tr><td><img src='../img/icons/add_marker.png'/><a href='#' id='menu1' onclick='marker()'>Markierung setzen</a></ br>"
				+ "<hr /></td></tr>"
				+ "<tr><td><img src='../img/icons/startroute.png'/><a href='#' id='menu2' onclick='polyline()'>Route setzen</a></ br>"
				+ "<hr /></td></tr>"
				+ "<tr><td><img src='../img/icons/distance.png'/><a href='#' onclick='distance()'>Abstand von hier</a></ br>"
				+ "<hr /></td></tr>"
				+ "<tr><td><img src='../img/icons/delete.png'/><a href='#' onclick='abbrechen()'>Abbrechen</a></td></tr>"
				+ "</table>";
		$(map.getDiv()).append(contextmenuDir);

		setMenuXY(caurrentLatLng);

		contextmenuDir.style.visibility = "visible";
	}

	function getCanvasXY(caurrentLatLng) {
		var scale = Math.pow(2, map.getZoom());
		var nw = new google.maps.LatLng(map.getBounds().getNorthEast().lat(),
				map.getBounds().getSouthWest().lng());
		var worldCoordinateNW = map.getProjection().fromLatLngToPoint(nw);
		var worldCoordinate = map.getProjection().fromLatLngToPoint(
				caurrentLatLng);
		var caurrentLatLngOffset = new google.maps.Point(Math
				.floor((worldCoordinate.x - worldCoordinateNW.x) * scale), Math
				.floor((worldCoordinate.y - worldCoordinateNW.y) * scale));
		return caurrentLatLngOffset;
	}
	function setMenuXY(caurrentLatLng) {
		var mapWidth = $('#map_canvas').width();
		var mapHeight = $('#map_canvas').height();
		var menuWidth = $('.contextmenu').width();
		var menuHeight = $('.contextmenu').height();
		var clickedPosition = getCanvasXY(caurrentLatLng);
		var x = clickedPosition.x;
		var y = clickedPosition.y;

		if ((mapWidth - x) < menuWidth)
			x = x - menuWidth;
		if ((mapHeight - y) < menuHeight)
			y = y - menuHeight;

		$('.contextmenu').css('left', x);
		$('.contextmenu').css('top', y);
	};

	//Marker setzen
	function marker() {
		$('.contextmenu').remove();
		if (lastmarker) {
			lastmarker.setMap(null);
		}
		var marker;
		if (abstandmessen == 1) {
			marker = new google.maps.Marker({
				position : lastmarker.getPosition(),
				map : map,
				icon : "../img/icons/flag7.png",
				draggable : false
			});
		} else {
			marker = new google.maps.Marker({
				position : lastmarker.getPosition(),
				map : map,
				icon : "../img/icons/flag7.png",
				draggable : true
			});
		}
		/*Marker Events*/
		/*Bei Klick auf Marker Men� anzeigen*/
		if (abstandmessen == 1) {
			//do nothing
		} else {
			google.maps.event.addListener(marker, 'click', function(event) {
				$('.contextmenu').remove();
				markerKoords = event.latLng;
				markerAkt = marker;
				showMarkerMenu(event.latLng);
			});
		}

		/*Dragstart-Event um die alte Position von Marker zu speichern*/
		google.maps.event.addListener(marker, 'dragstart', function(event) {
			oldMarker = this.getPosition();
		});
		/*Bei Bewegen eines Markers wird Route neu gezeichnet*/
		google.maps.event.addListener(marker, 'dragend', function(event) {
			/*Route Point anpassen*/
			for ( var i = routePoints.length - 1; i >= 0; i--) {
				if (oldMarker == routePoints[i]) {
					routePoints[i] = event.latLng;
				}
			}
			/*Polylines ausblenden + l�schen*/
			for ( var i = polylines.length - 1; i >= 0; i--) {
				polylines[i].setMap(null);
				polylines.pop();
			}
			/*Route neu zeichnen*/
			aktualisieren = 1;
			if (routezeichnen != 1) {
				routezeichnen = 1;
			}
			polyline();
			aktualisieren = 0;
			/*Falls Route beendet wurde routezeichnen wieder auf 0 setzen*/
			if (routebeendet == 1) {
				routezeichnen = 0;
			}
		});

		/*wenn Route gezeichnet oder Abstand gemessen wird Marker zu Feld hinzuf�gen*/
		if (routezeichnen == 1) {
			routePoints.push(marker.getPosition());
			markers.push(marker);
		} else if (abstandmessen == 1) {
			abstandPoints.push(marker.getPosition());
			abstandmarkers.push(marker);
			polyline();
		}
	}

	//Route zeichnen
	function polyline() {
		if (routezeichnen == 0 && abstandmessen == 0) {
			/*Wenn Route nicht aktualisiert wird alle Marker,Polylines l�schen*/
			if (aktualisieren != 1) {
				deleteMarkersRoute();
			}
			routezeichnen = 1;
			//Men� ausblenden wenn Route gezeichnet wird
			$('.contextmenu').remove();
			//Button einblenden
			controlText.innerHTML = 'Route beenden';
			redoText.innerHTML = 'R&uuml;ckg&auml;ngig';
			abbrechenText.innerHTML = 'Route abbrechen';
			controlUI.style.display = 'block';
			redoUI.style.display = 'block';
			abbrechenUI.style.display = 'block';
			marker();
		} else {
			if (routezeichnen == 1) {
				route = new google.maps.Polyline({
					path : routePoints,
					strokeColor : "#FF0000",
					strokeOpacity : 1.0,
					strokeWeight : 2
				});
				polylines.push(route);
			} else if (abstandmessen == 1) {
				route = new google.maps.Polyline({
					path : abstandPoints,
					strokeColor : "#0000FF",
					strokeOpacity : 1.0,
					strokeWeight : 2
				});
				abstandpolylines.push(route);
				getDistance();
			} else {
				//do nothing
			}
			route.setMap(map);
			routegezeichnet = 1;
		}
	}

	//Abstand messen
	function distance(event) {
		if (abstandmessen == 0) {
			abstandmessen = 1;
			//Men� ausblenden wenn Abstand gemessen wird
			$('.contextmenu').remove();
			//Button einblenden
			getDistance();
			// document.getElementById('test').style.display = "block";
			controlText.innerHTML = 'Abstandsmessung beenden';
			controlUI.style.display = 'block';
			redoText.innerHTML = '';
			redoUI.style.display = 'block';
			abbrechenText.innerHTML = '';
			marker();
		}
	}
	//gemessener Abstand ausgeben
	function getDistance() {
		var p1;
		var p2;
		var sum = 0;
		for ( var i = 0; i < abstandPoints.length - 1; i++) {
			p1 = abstandPoints[i];
			p2 = abstandPoints[i + 1];
			sum = sum
					+ google.maps.geometry.spherical.computeDistanceBetween(p1,
							p2);
		}
		var sm = sum / 1852; //1sm = 1852m
		/*Ausgabe....runden*/
		var faktor = Math.pow(10, 3);
		var ausgabe = Math.round(sm * faktor) / faktor;
		//alert(sum + "Meter\n" + sm + "Seemeilen");
		//alert(ausgabe);
		redoText.innerHTML = ausgabe + "nm";
	}

	//Abbrechen
	function abbrechen() {
		$('.contextmenu').remove();
		lastmarker.setMap(null);
	}

	
	/*Buttons*/
	function beenden(controlDiv, map) {
		controlDiv.style.paddding = '5px';
		//CSS Beenden Button
		controlUI = document.createElement('DIV');
		controlUI.style.backgroundColor = '#0a204a';
		controlUI.style.height = '30px';
		controlUI.style.borderStyle = 'solid';
		controlUI.style.borderWidth = '1px';
		controlUI.style.cursor = 'pointer';
		controlUI.style.textAlign = 'center';
		controlUI.style.display = 'none';
		controlUI.style.margin = '10px';
		controlUI.title = 'Beenden';
		controlDiv.appendChild(controlUI);
		//CSS Beenden Text
		controlText = document.createElement('DIV');
		controlText.style.fontFamily = 'Arial,sans-serif';
		controlText.style.color = '#ffffff';
		controlText.style.fontSize = '12px';
		controlText.style.paddingLeft = '4px';
		controlText.style.paddingRight = '4px';
		controlText.style.paddingTop = '5px';
		controlText.innerHTML = '';
		controlUI.appendChild(controlText);

		//CSS Redo Button
		redoUI = document.createElement('DIV');
		redoUI.style.backgroundColor = '#0a204a';
		redoUI.style.height = '30px';
		redoUI.style.borderStyle = 'solid';
		redoUI.style.borderWidth = '1px';
		redoUI.style.cursor = 'pointer';
		redoUI.style.textAlign = 'center';
		redoUI.style.display = 'none';
		redoUI.style.margin = '10px';
		redoUI.title = 'R&uuml;ckg&auml;ngig';
		controlDiv.appendChild(redoUI);
		//CSS Redo Text
		redoText = document.createElement('DIV');
		redoText.style.fontFamily = 'Arial,sans-serif';
		redoText.style.color = '#ffffff';
		redoText.style.fontSize = '12px';
		redoText.style.paddingLeft = '4px';
		redoText.style.paddingRight = '4px';
		redoText.style.paddingTop = '25px';
		redoText.innerHTML = '';
		controlUI.appendChild(redoText);

		//CSS Abbrechen Button
		abbrechenUI = document.createElement('DIV');
		abbrechenUI.style.backgroundColor = '#0a204a';
		abbrechenUI.style.height = '30px';
		abbrechenUI.style.borderStyle = 'solid';
		abbrechenUI.style.borderWidth = '1px';
		abbrechenUI.style.cursor = 'pointer';
		abbrechenUI.style.textAlign = 'center';
		abbrechenUI.style.display = 'none';
		abbrechenUI.style.margin = '10px';
		abbrechenUI.title = 'Abbrechen';
		controlDiv.appendChild(abbrechenUI);
		//CSS Abbrechen Text
		abbrechenText = document.createElement('DIV');
		abbrechenText.style.fontFamily = 'Arial,sans-serif';
		abbrechenText.style.color = '#ffffff';
		abbrechenText.style.fontSize = '12px';
		abbrechenText.style.paddingLeft = '4px';
		abbrechenText.style.paddingRight = '4px';
		abbrechenText.style.paddingTop = '27px';
		abbrechenText.innerHTML = '';
		controlUI.appendChild(abbrechenText);

		//Route beenden, Abstandmessen beenden
		google.maps.event.addDomListener(controlUI, 'click', function() {
			if (routezeichnen == 1) {
				finishRoute();
			} else if (abstandmessen == 1) {
				deleteMarkersDistance();
			} else {
				//do nothing
			}
		});
		//Route letzter Marke r�ckg�ngig
		google.maps.event.addDomListener(redoUI, 'click', function() {
			redoMarker();
		});
		//Route abbrechen
		google.maps.event.addDomListener(abbrechenUI, 'click', function() {
			check = confirm("Route wirklich abbrechen?");
			if (check == true) {
				deleteMarkersRoute();
			} else {
				//do nothing
			}
		});
	}

	//Route beenden
	function finishRoute() {
		if (routezeichnen == 1) {
			routezeichnen = 0;
			routebeendet = 1;
			controlUI.style.display = 'none';
			abbrechenUI.style.display = 'none';
			redoUI.style.display = 'none';
		} else if (abstandmessen == 1) {
			abstandmessen = 0;
			controlUI.style.display = 'none';
			redoUI.style.display = 'none';
		}
	}
	//Redo
	function redoMarker() {
		//letzter Marker l�schen
		markers[markers.length - 1].setMap(null);
		markers.pop();
		//Route ausblenden
		for ( var i = 0; i < polylines.length; i++) {
			polylines[i].setMap(null);
		}
		//letzte Polyline l�schen
		polylines.pop();
		routePoints.pop();
		//Route neu zeichnen
		polyline();
	}
	//Route l�schen
	function deleteMarkersRoute() {
		max = markers.length;
		/*Polylines ausblenden*/
		for ( var i = 0; i < polylines.length; i++) {
			polylines[i].setMap(null);
		}
		/*Marker l�schen und ausblenden*/
		for ( var i = max - 1; i >= 0; i--) {
			markers[i].setMap(null);
			markers.pop();
		}
		/*Route Points l�schen*/
		for ( var i = routePoints.length - 1; i >= 0; i--) {
			routePoints.pop();
		}
		/*Route zeichnen beenden*/
		finishRoute();
	}
	//Abstand l�schen
	function deleteMarkersDistance() {
		max = abstandmarkers.length;
		/*Polylines ausblenden*/
		for ( var i = 0; i < abstandpolylines.length; i++) {
			abstandpolylines[i].setMap(null);
		}
		/*Marker l�schen und ausblenden*/
		for ( var i = max - 1; i >= 0; i--) {
			abstandmarkers[i].setMap(null);
			abstandmarkers.pop();
		}
		/*Route Points l�schen*/
		for ( var i = abstandPoints.length - 1; i >= 0; i--) {
			abstandPoints.pop();
		}
		/*Abstand messen beenden*/
		finishRoute();
	}

	//Marker l�schen durch Marker Men�
	function markerDelete() {
		/*ausgew�hlter Marker ausblenden*/
		for ( var i = 0; i < markers.length; i++) {
			if (markerKoords == markers[i].getPosition()) {
				markers[i].setMap(null);
			}
		}
		/*Route Points anpassen*/
		for ( var i = routePoints.length - 1; i >= 0; i--) {
			if (markerKoords == routePoints[i]) {
				routePoints.splice(i, 1);
			}
		}
		/*Polylines ausblenden + l�schen*/
		for ( var i = polylines.length - 1; i >= 0; i--) {
			polylines[i].setMap(null);
			polylines.pop();
		}
		/*Route neu zeichnen*/
		aktualisieren = 1;
		if (routezeichnen != 1) {
			routezeichnen = 1;
		}
		polyline();
		aktualisieren = 0;
		/*Falls Route beendet wurde routezeichnen wieder auf 0 setzen*/
		if (routebeendet == 1) {
			routezeichnen = 0;
		}
		/*Marker Men� ausblenden*/
		$('.markermenu').remove();
	}

	function showWeatherInfo(bild, luftdruck) {
		var projection;
		var weatherMenu;
		projection = map.getProjection();
		$('.markermenu').remove();
		weatherMenu = document.createElement("div");
		weatherMenu.className = "weathermenu";
		weatherMenu.innerHTML = "<table>"
				+ "<tr><td>"
				+ bild
				+ "</td></tr>"
				+ "<tr><td>Luftdruck(kPa):"
				+ luftdruck
				+ "</td></tr>"
				+ "<tr><td><hr /></td></tr>"
				+ "<tr><td><img src='../img/icons/delete.png'/><a href='#' id='abbrechen' onclick='hideWeatherMenu()'>Schlie&szlig;en</a></td></tr>"
				+ "</table>";
		$(map.getDiv()).append(weatherMenu);
		setWeatherMenu();
		weatherMenu.style.visibility = "visible";
	}

	/*Marker Men� anzeigen*/
	function showMarkerMenu(caurrentLatLng) {
		var projection;
		var markerMenu;
		projection = map.getProjection();
		$('.markermenu').remove();
		markerMenu = document.createElement("div");
		markerMenu.className = "markermenu";
		markerMenu.innerHTML = "<table>"
				+ "<tr><td><img src='../img/icons/delete_marker.png'/><a href='#' id='deletemarker' onclick='markerDelete()'>L&ouml;schen</a></td></tr>"
				+ "<tr><td><hr /></td></tr>"
				+ "<tr><td><img src='../img/icons/delete.png'/><a href='#' id='abbrechen' onclick='hideMarkerMenu()'>Abbrechen</a></td></tr>"
				+ "</table>";
		$(map.getDiv()).append(markerMenu);
		setMarkerMenu(caurrentLatLng);
		markerMenu.style.visibility = "visible";
	}

	function setMarkerMenu(caurrentLatLng) {

		var mapWidth = $('#map_canvas').width();
		var mapHeight = $('#map_canvas').height();
		var menuWidth = $('.markermenu').width();
		var menuHeight = $('.markermenu').height();
		var clickedPosition = getCanvasXY(caurrentLatLng);
		var x = clickedPosition.x;
		var y = clickedPosition.y;

		if ((mapWidth - x) < menuWidth)//if to close to the map border, decrease x position
			x = x - menuWidth;
		if ((mapHeight - y) < menuHeight)//if to close to the map border, decrease y position
			y = y - menuHeight;

		$('.markermenu').css('left', x);
		$('.markermenu').css('top', y);
	}

	function setWeatherMenu() {

		$('.weathermenu').css('left', 300);
		$('.weathermenu').css('top', 0);
	}

	//Marker l�schen durch Marker Men�
	function markerDelete() {

		markerAkt.setMap(null);
		/*ausgew�hlter Marker ausblenden*/
		for ( var i = 0; i < markers.length; i++) {
			if (markerKoords == markers[i].getPosition()) {
				markers[i].setMap(null);
			}
		}
		/*Route Points anpassen*/
		for ( var i = routePoints.length - 1; i >= 0; i--) {
			if (markerKoords == routePoints[i]) {
				routePoints.splice(i, 1);
			}
		}
		/*Polylines ausblenden + l�schen*/
		for ( var i = polylines.length - 1; i >= 0; i--) {
			polylines[i].setMap(null);
			polylines.pop();
		}
		/*Route neu zeichnen*/
		aktualisieren = 1;
		if (routezeichnen != 1) {
			routezeichnen = 1;
		}
		polyline();
		aktualisieren = 0;
		/*Falls Route beendet wurde routezeichnen wieder auf 0 setzen*/
		if (routebeendet == 1) {
			routezeichnen = 0;
		}
		/*Marker Men� ausblenden*/
		$('.markermenu').remove();
	}
	//Marker Men� ausblenden
	function hideMarkerMenu() {
		$('.markermenu').remove();
	}

	//Weather Men� ausblenden
	function hideWeatherMenu() {
		$('.weathermenu').remove();
	}

	// google.maps.event.addDomListener(window, 'load', initialize);

	
</script>


</head>
<body onload="initialize();">
	<!--Buttons-->
	

			
	<div id="buttons">
		<ul>
   			<li><a href='Boatinfo.jsp'><span>Zum Logbuch</span></a></li>
   			<li class='last'><a href='#' id='startSimulation' onclick="sendChat()"><span>Tracking-Demo</span></a></li>
		</ul>
	</div>
	
	
	<!-- Distancetool 
	<div id="distanceTool">
		<ul>
   			<li><a href='Boatinfo.jsp'><span>Test1</span></a></li>
   			<li class='last'><a href='#' id='connect' onclick='redoMarker()'><span>Tracking-Demo</span></a></li>
		</ul>
	</div>-->
	
	<!---Koordinaten-->
	<div id="koords">
		Latitude <span id="lat">47°66.00'N</span> Longitude <span id="long">009°16.00'E
		</span>
	</div>
	
	
	<!-- Weather Display Box-->
            <div id="weatherinformation" class="olPopup" style="position: absolute; overflow: hidden; left: 988px; top: 256px; width: 182px; height: 185px; background-color: white; opacity: 1; border: 0px none; z-index: 751;">
			<div id="FramedCloud_GroupDiv" style="position: relative; overflow: hidden;">
				<div id="FramedCloud_contentDiv" class="olPopupContent" style="width: 150px; height: 175px; position: relative; overflow: auto;">
					<p class="weather_title">
						<span id="city_name"></span>
					</p>
					<div class="weather_block">
						<div class="cur_weather_block" title="broken clouds">
							<img class="weather_image" src="http://openweathermap.org/img/w/04d.png" alt="broken clouds">
							<div class="temp_block">
								<div class="big_temp" title="Current Temperature">
									19.8°
								</div>
								<div class="small_temp_block">
									<div class="small_temp">
										Clouds
									</div>
								</div>
							</div>
						</div>
						<div class="small_val_grey" title="Min and max temperature">
							Min t: <span id="min_temp"></span> / Max t: <span id="max_temp"></span>°
						</div>
						<div class="small_val_grey">
							Humidity: 65%
						</div>
						<div class="small_val_grey">
							Wind: 1.03 m/s
						</div>
						<div class="small_val_grey">
							Clouds: 76 %
						</div>
					</div>
				</div>
				<div id="FramedCloud_close" class="olPopupCloseBox" style="width: 17px; height: 17px; position: absolute; right: 5px; top: 5px;"></div>
			</div>
		</div>

	<!-- <div id="weatherinformation">
		<div class="weatherinformation_header">
			<div data-toggle="buttons-radio" class="btn-group span4">
	             <button id="now" class="btn btn-info span1 active">Aktuell</button>
	            <button id="today" class="btn btn-info span1">Heute</button>
	            <button id="tomorrow" class="btn btn-info span1">Morgen</button>
	            <button id="3days" class="btn btn-info span1">3 Tage</button>
	            <button id="7days" class="btn btn-info span1">7 Tage</button>
        	</div>
		</div>
		<div class="left_block block_2">
			<div class="content">
				Max: <span id="max_temp"></span>
				Min: <span id="min_temp">></span>
			</div>
		</div>
		<div class="right_block block_3">
			<div class="content">
			</div>
		</div>
		<div class="center_block block_5">
			<div id="weather_icon">
			</div>
		</div>
		<div class="bottom_block block_4">
			<div class="content">
				 Luftdruck: <span id="pressure"></span>
            	 Wolken: <span id="clouds"></span>
			</div>
		</div>
        
	</div> -->
	
	<!--Karte-->
	<div class="formDiv" id="map_canvas"></div>

</body>
</html>